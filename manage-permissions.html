<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="shortcut icon"
      href="assets/img/UN_Habitat_Icon.svg"
      type="image/x-icon"
    />
    <title>Manage Permissions</title>
    <!-- Fonts and icons -->
    <link href="libraries/css/inter.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <link href="libraries/css/fontawesome-6.5.1.min.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link
      id="pagestyle"
      href="assets/css/soft-ui-dashboard.css?v=1.1.0"
      rel="stylesheet"
    />

    <!-- Simplified Arabic Font -->
    <link href="libraries/css/noto-naskh-arabic.css" rel="stylesheet" />
    <!-- Github buttons -->

    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="libraries/js/soft-ui-dashboard-1.1.0.min.js"></script>
    <link href="libraries/css/inter.css" rel="stylesheet" />
    <link href="libraries/css/fontawesome-6.5.1.min.css" rel="stylesheet" />
    <link href="libraries/css/noto-naskh-arabic.css" rel="stylesheet" />

    <!-- Common styles -->
    <link href="assets/css/styles.css" rel="stylesheet" />

    <style>
      /* Page-specific styles for manage-permissions.html */

      .menu-item i {
        margin-left: 8px;
        width: 20px;
        text-align: center;
      }

      .menu-item:hover {
        background-color: #f5f5f5;
      }

      body[dir="ltr"] .menu-dropdown-content {
        right: auto;
        left: 0;
      }

      body[dir="ltr"] .menu-item i {
        margin-left: 0;
        margin-right: 8px;
      }

      /* Enhanced Table Header Styles */
      .card-header h6 {
        font-size: 1.5rem !important;
        font-weight: 700 !important;
        color: #344767 !important;
        margin-bottom: 0.5rem !important;
      }

      .table thead th {
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        color: #344767 !important;
        padding: 1rem 0.75rem !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
        border-bottom: 2px solid #e9ecef !important;
        background-color: #f8f9fa !important;
      }

      .table thead th.text-uppercase {
        font-size: 1.1rem !important;
        font-weight: 600 !important;
      }

      /* Font Awesome icon styles */
      .fa,
      .fab,
      .fas,
      .far,
      i.fa,
      i.fab,
      i.fas,
      i.far,
      i.fa-facebook-f,
      i.fa-x-twitter,
      i.fa-instagram,
      i.fa-linkedin-in,
      i.fa-whatsapp {
        font-family: "Font Awesome 6 Free", "Font Awesome 6 Brands" !important;
        display: inline-block !important;
        visibility: visible !important;
      }

      /* Notification styles */
      #notificationContainer {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 350px;
      }

      .notification {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        animation: slideIn 0.3s ease-out;
        position: relative;
        overflow: hidden;
      }

      .notification.success {
        background-color: #d4edda;
        border-left: 4px solid #28a745;
        color: #155724;
      }

      .notification.error {
        background-color: #f8d7da;
        border-left: 4px solid #dc3545;
        color: #721c24;
      }

      .notification.info {
        background-color: #d1ecf1;
        border-left: 4px solid #17a2b8;
        color: #0c5460;
      }

      .notification.warning {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        color: #856404;
      }

      .notification-icon {
        font-size: 20px;
        margin-left: 12px;
        margin-right: 0;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: bold;
        margin-bottom: 4px;
      }

      .notification-message {
        font-size: 14px;
        margin: 0;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        padding: 0;
        margin-right: 5px;
        margin-left: 0;
        opacity: 0.7;
      }

      .notification-close:hover {
        opacity: 1;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .notification.slide-out {
        animation: slideOut 0.3s ease-in forwards;
      }

      /* RTL/LTR specific styles */
      body[dir="ltr"] #notificationContainer {
        right: auto;
        left: 20px;
      }

      body[dir="ltr"] .notification-icon {
        margin-left: 0;
        margin-right: 12px;
      }

      body[dir="ltr"] .notification-close {
        margin-right: 0;
        margin-left: 5px;
      }

      body[dir="ltr"] .notification {
        animation: slideInLTR 0.3s ease-out;
      }

      body[dir="ltr"] .notification.slide-out {
        animation: slideOutLTR 0.3s ease-in forwards;
      }

      @keyframes slideInLTR {
        from {
          transform: translateX(-100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutLTR {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(-100%);
          opacity: 0;
        }
      }
    </style>
  </head>

  <body class="g-sidenav-show bg-gray-100">
    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Header -->
    <header id="mainHeader">
      <div style="display: flex; align-items: center; gap: 10px">
        <img src="assets/img/aleppo.jfif" alt="Logo 1" class="header-logo" />
      </div>

      <div class="header-title text-center">
        <div class="title-ar">نظام إدارة المعلومات الحضرية _ مدينة حلب</div>
        <div class="title-en">
          Urban Information Management System - Aleppo City
        </div>
      </div>

      <div class="header-logos right-logos">
        <div class="menu-dropdown">
          <button
            title="toggle language"
            class="menu-toggle"
            id="menuToggleBtn"
            onclick="toggleMenu()"
          ></button>
          <div class="menu-dropdown-content" id="menuDropdown">
            <a
              href="#"
              class="menu-item"
              id="langToggleBtn"
              onclick="toggleLanguage();"
            >
              <i class="fas fa-language"></i>
              <span id="langToggleText">تغيير اللغة</span>
            </a>
            <a
              href="#"
              class="menu-item"
              id="settingsBtn"
              onclick="window.location.href = './profile.html';"
            >
              <i class="fas fa-cog"></i>
              <span id="settingsText">الإعدادات</span>
            </a>
            <a
              href="#"
              class="menu-item"
              id="logoutBtn"
              onclick="logoutUser();"
            >
              <i class="fas fa-sign-out-alt"></i>
              <span id="logoutText">تسجيل الخروج</span>
            </a>
          </div>
        </div>
        <a href="./welcome.html" title="UN Habitat">
          <img
            src="assets/img/unhabitat.png"
            alt="Logo 3"
            class="header-logo"
            style="cursor: pointer; background-color: #fff"
          />
        </a>
        <img src="assets/img/japan.jpg" alt="Logo 2" class="header-logo" />
      </div>
    </header>

    <aside
      class="sidenav navbar navbar-vertical navbar-expand-xs border-0 my-3 fixed-end bg-gray-300"
      id="sidenav-main"
      style="max-height: calc(100vh - 66px); overflow-y: visible"
    >
      <div class="sidenav-header">
        <i
          class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
          aria-hidden="true"
          id="iconSidenav"
        ></i>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-tachometer-alt"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">Dashboard</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="tables.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-table"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">configuration Tables </span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link active" href="ManageUsers.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
                style="
                  background: linear-gradient(
                    135deg,
                    #007bff 0%,
                    #0056b3 100%
                  ) !important;
                "
              >
                <i
                  class="fas fa-users-cog"
                  style="color: white; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">Manage users</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="neighborhoodCommitteesManagement.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-users"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">إدارة لجان الأحياء</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="developmentCommitteesManagement.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-chart-line"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">إدارة لجان التنمية</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="sidenav-footer mx-3"></div>
    </aside>
    <main
      class="main-content position-relative max-height-vh-100 h-100 border-radius-lg"
    >
      <!-- Table Section -->
      <div class="container-fluid py-4">
        <div class="row">
          <div class="col-12 mt-5">
            <div class="card mb-4">
              <div
                class="card-header pb-0 d-flex justify-content-between align-items-center"
              >
                <h6 id="pageTitle">قائمة السماحيات</h6>
                <div class="d-flex gap-2">
                  <button
                    class="btn btn-primary btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#addPermissionModal"
                    style="background-color: #007bff; border-color: #007bff"
                  >
                    <i class="fas fa-plus"></i>
                    <span id="addPermissionText">إضافة سماحية</span>
                  </button>
                  <button
                    class="btn btn-warning btn-sm"
                    onclick="resetToDefault()"
                    style="
                      background: linear-gradient(
                        135deg,
                        #ffc107 0%,
                        #fd7e14 100%
                      );
                      border: none;
                      box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
                    "
                    title="إعادة تعيين البيانات إلى الحالة الافتراضية"
                  >
                    <i class="fas fa-undo"></i>
                    <span id="resetButtonText">إعادة تعيين</span>
                  </button>
                </div>
              </div>
              <div class="card-body px-0 pt-0 pb-2">
                <div class="table-responsive p-0">
                  <table class="table align-items-center mb-0">
                    <thead>
                      <tr>
                        <th
                          class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"
                        >
                          اسم الإذن
                        </th>
                        <th
                          class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"
                        >
                          الوصف
                        </th>
                        <th
                          class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"
                        >
                          الإجراءات
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <h6 class="mb-0 text-sm">إضافة مستخدم</h6>
                        </td>
                        <td>
                          <p class="text-xs font-weight-bold mb-0">
                            سماحية لإضافة مستخدم جديد.
                          </p>
                        </td>
                        <td class="align-middle text-center">
                          <a
                            href="#"
                            class="btn btn-link text-dark px-3 mb-0"
                            data-bs-toggle="modal"
                            data-bs-target="#editPermissionModal"
                          >
                            <i
                              class="fas fa-pencil-alt text-dark me-2"
                              aria-hidden="true"
                            ></i
                            >تعديل
                          </a>
                          <a
                            href="#"
                            class="btn btn-link text-danger text-gradient px-3 mb-0"
                          >
                            <i
                              class="far fa-trash-alt me-2"
                              aria-hidden="true"
                            ></i
                            >حذف
                          </a>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <h6 class="mb-0 text-sm">تعديل مستخدم</h6>
                        </td>
                        <td>
                          <p class="text-xs font-weight-bold mb-0">
                            سماحية لتعديل بيانات المستخدمين.
                          </p>
                        </td>
                        <td class="align-middle text-center">
                          <a
                            href="#"
                            class="btn btn-link text-dark px-3 mb-0"
                            data-bs-toggle="modal"
                            data-bs-target="#editPermissionModal"
                          >
                            <i
                              class="fas fa-pencil-alt text-dark me-2"
                              aria-hidden="true"
                            ></i
                            >تعديل
                          </a>
                          <a
                            href="#"
                            class="btn btn-link text-danger text-gradient px-3 mb-0"
                          >
                            <i
                              class="far fa-trash-alt me-2"
                              aria-hidden="true"
                            ></i
                            >حذف
                          </a>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Add Permission Modal -->
    <div
      class="modal fade"
      id="addPermissionModal"
      tabindex="-1"
      aria-labelledby="addPermissionModalLabel"
      aria-hidden="true"
      data-bs-backdrop="false"
    >
      <div class="modal-dialog pt-5">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addPermissionModalLabel">
              إضافة سماحية جديد
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addPermissionForm">
              <div class="mb-3">
                <label for="permissionType" class="form-label">نوع الإذن</label>
                <select class="form-control" id="permissionType">
                  <option value="page">صفحة</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="permissionName" class="form-label">اسم الإذن</label>
                <input
                  type="text"
                  class="form-control"
                  id="permissionName"
                  placeholder="أدخل اسم الإذن"
                />
              </div>
              <div class="mb-3">
                <label for="permissionCode" class="form-label">كود الإذن</label>
                <input
                  type="text"
                  class="form-control"
                  id="permissionCode"
                  placeholder="أدخل كود الإذن"
                />
              </div>
              <div class="mb-3 page-fields">
                <label for="pageSelect" class="form-label">الصفحة</label>
                <select class="form-control" id="pageSelect"></select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              إغلاق
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="savePermissionBtn"
              style="background-color: #007bff; border-color: #007bff"
            >
              حفظ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Permission Modal -->
    <div
      class="modal fade"
      id="editPermissionModal"
      tabindex="-1"
      aria-labelledby="editPermissionModalLabel"
      aria-hidden="true"
      data-bs-backdrop="false"
    >
      <div class="modal-dialog pt-5">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editPermissionModalLabel">
              تعديل الإذن
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="editPermissionName" class="form-label"
                  >اسم الإذن</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editPermissionName"
                  placeholder="أدخل اسم الإذن"
                />
              </div>
              <div class="mb-3">
                <label for="editPermissionDescription" class="form-label"
                  >الوصف</label
                >
                <textarea
                  class="form-control"
                  id="editPermissionDescription"
                  rows="3"
                  placeholder="أدخل وصف الإذن"
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              إغلاق
            </button>
            <button
              type="button"
              class="btn btn-primary"
              style="background-color: #007bff; border-color: #007bff"
            >
              حفظ التغييرات
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="fixed-plugin">
      <a
        id="helpButton"
        class="fixed-plugin-button text-dark position-fixed px-3 py-2"
        style="bottom: 40px; z-index: 6000"
      >
        <i class="fa fa-question-circle py-2"> </i>
      </a>
    </div>
    <!--   Core JS Files   -->
    <script src="libraries/js/buttons.js" async defer></script>
    <script src="libraries/js/popper-2.11.8.min.js"></script>
    <script src="libraries/js/bootstrap-5.3.2.min.js"></script>
    <script>
      // Wait for DOM to be fully loaded
      document.addEventListener("DOMContentLoaded", function () {
        // Function to handle zoom level changes
        function handleZoom() {
          const sidenav = document.getElementById("sidenav-main");
          const windowWidth = window.innerWidth;
          const zoomLevel = window.devicePixelRatio;

          if (zoomLevel > 1.51 || windowWidth < 1200) {
            sidenav.style.display = "none";
          } else {
            sidenav.style.display = "block";
          }
        }

        // Initial check
        handleZoom();

        // Listen for zoom changes
        window.addEventListener("resize", handleZoom);

        // Initialize charts only if the canvas elements exist
        try {
          // Line chart
          if (document.getElementById("chart-line")) {
            var ctx2 = document.getElementById("chart-line").getContext("2d");

            var gradientStroke1 = ctx2.createLinearGradient(0, 230, 0, 50);
            gradientStroke1.addColorStop(1, "rgba(203,12,159,0.2)");
            gradientStroke1.addColorStop(0.2, "rgba(72,72,176,0.0)");
            gradientStroke1.addColorStop(0, "rgba(203,12,159,0)"); //purple colors

            var gradientStroke2 = ctx2.createLinearGradient(0, 230, 0, 50);
            gradientStroke2.addColorStop(1, "rgba(20,23,39,0.2)");
            gradientStroke2.addColorStop(0.2, "rgba(72,72,176,0.0)");
            gradientStroke2.addColorStop(0, "rgba(20,23,39,0)"); //purple colors

            window.lineChart = new Chart(ctx2, {
              type: "line",
              data: {
                labels: [
                  "Apr",
                  "May",
                  "Jun",
                  "Jul",
                  "Aug",
                  "Sep",
                  "Oct",
                  "Nov",
                  "Dec",
                ],
                datasets: [
                  {
                    label: "Foods",
                    tension: 0.4,
                    borderWidth: 3,
                    pointRadius: 0,
                    borderColor: "#cb0c9f",
                    backgroundColor: gradientStroke1,
                    fill: true,
                    data: [50, 40, 300, 220, 500, 250, 400, 230, 500],
                    maxBarThickness: 6,
                  },
                  {
                    label: "Health",
                    tension: 0.4,
                    borderWidth: 3,
                    pointRadius: 0,
                    borderColor: "#3A416F",
                    backgroundColor: gradientStroke2,
                    fill: true,
                    data: [30, 90, 40, 140, 290, 290, 340, 230, 400],
                    maxBarThickness: 6,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false,
                  },
                },
                interaction: {
                  intersect: false,
                  mode: "index",
                },
                scales: {
                  y: {
                    grid: {
                      drawBorder: false,
                      display: true,
                      drawOnChartArea: true,
                      drawTicks: false,
                      borderDash: [5, 5],
                    },
                    ticks: {
                      display: true,
                      padding: 10,
                      color: "#b2b9bf",
                      font: {
                        size: 11,
                        family: "Inter",
                        style: "normal",
                        lineHeight: 2,
                      },
                    },
                  },
                  x: {
                    grid: {
                      drawBorder: false,
                      display: false,
                      drawOnChartArea: false,
                      drawTicks: false,
                      borderDash: [5, 5],
                    },
                    ticks: {
                      display: true,
                      color: "#b2b9bf",
                      padding: 20,
                      font: {
                        size: 11,
                        family: "Inter",
                        style: "normal",
                        lineHeight: 2,
                      },
                    },
                  },
                },
              },
            });
          }

          // Service supply data
          if (document.getElementById("serviceChart")) {
            window.serviceChart = new Chart(
              document.getElementById("serviceChart"),
              {
                type: "pie",
                data: {
                  labels: ["مياه", "كهرباء", "صرف صحي", "لا شيء"],
                  datasets: [
                    {
                      data: [120, 140, 100, 30],
                      backgroundColor: [
                        "#0d6efd",
                        "#198754",
                        "#ffc107",
                        "#dc3545",
                      ],
                    },
                  ],
                },
              }
            );
          }

          // Construction status data
          if (document.getElementById("constructionChart")) {
            window.constructionChart = new Chart(
              document.getElementById("constructionChart"),
              {
                type: "bar",
                data: {
                  labels: ["صالح", "متصدع", "متهالك", "جيد"],
                  datasets: [
                    {
                      label: "عدد المنشآت",
                      data: [85, 20, 10, 40],
                      backgroundColor: "#198754",
                    },
                  ],
                },
                options: {
                  scales: {
                    y: { beginAtZero: true },
                  },
                },
              }
            );
          }

          // Health status data
          if (document.getElementById("healthChart")) {
            window.healthChart = new Chart(
              document.getElementById("healthChart"),
              {
                type: "bar",
                data: {
                  labels: ["مشفى", "مستوصف", "عيادة متنقلة", "عيادة"],
                  datasets: [
                    {
                      label: "عدد المراكز الصحية",
                      data: [85, 30, 15, 55],
                      backgroundColor: "blue",
                    },
                  ],
                },
                options: {
                  scales: {
                    y: { beginAtZero: true },
                  },
                },
              }
            );
          }

          // Educational status data
          if (document.getElementById("educationChart")) {
            window.educationChart = new Chart(
              document.getElementById("educationChart"),
              {
                type: "bar",
                data: {
                  labels: ["جامعة", "مدرسة", "مدارس خاصة", "روضات"],
                  datasets: [
                    {
                      label: " عدد المنشآت التعليمية ",
                      data: [2, 80, 30, 20],
                      backgroundColor: "yellow",
                    },
                  ],
                },
                options: {
                  scales: {
                    y: { beginAtZero: true },
                  },
                },
              }
            );
          }
        } catch (error) {
          console.error("Error initializing charts:", error);
        }

        // Initialize scrollbar
        var win = navigator.platform.indexOf("Win") > -1;
        if (win && document.querySelector("#sidenav-scrollbar")) {
          var options = {
            damping: "0.5",
          };
          Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
        }

        // Initialize mock data and load permissions
        initializeMockData();
        fetchPermissions();
      });
    </script>
    <script>
      var win = navigator.platform.indexOf("Win") > -1;
      if (win && document.querySelector("#sidenav-scrollbar")) {
        var options = {
          damping: "0.5",
        };
        Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
      }
    </script>

    <!-- Language Toggle Script -->
    <script>
      const translations = {
        ar: {
          dir: "rtl",
          dashboard: "لوحة التحكم",
          configTables: "جداول الإعدادات",
          maps: "الخرائط",
          manageUsers: "إدارة المستخدمين ",
          langToggleText: "تغيير اللغة",
          signIn: "تسجيل الدخول",
          signUp: "إنشاء حساب",
          permissionsList: "قائمة السماحيات",
          addPermission: "إضافة سماحية",
          editPermission: "تعديل الإذن",
          permissionName: "اسم الإذن",
          permissionDescription: "الوصف",
          enterPermissionName: "أدخل اسم الإذن",
          enterPermissionDescription: "أدخل وصف الإذن",
          close: "إغلاق",
          save: "حفظ",
          saveChanges: "حفظ التغييرات",
          actions: "الإجراءات",
          edit: "تعديل",
          delete: "حذف",
          confirmDelete: "هل أنت متأكد من حذف هذا الإذن؟",
          fillAllFields: "الرجاء ملء جميع الحقول",
          demoModeTitle: "وضع التجربة:",
          demoModeText:
            "هذه الصفحة تعمل بدون خادم خلفي. جميع البيانات محفوظة محلياً في المتصفح.",
          resetButtonText: "إعادة تعيين",
          resetConfirmMessage:
            "هل أنت متأكد من إعادة تعيين جميع البيانات إلى الحالة الافتراضية؟",
          resetSuccessMessage: "تم إعادة تعيين البيانات بنجاح",
          families: "عدد الأسر",
          validBuildings: "منشآت صالحة",
          residentialBuildings: "منشآت سكنية",
          threatened: "مهددة بالإزالة",
          constructionStatus: "الوضع الإنشائي",
          educationStatus: "الوضع التعليمي",
          healthStatus: "الوضع الصحي",
          footerText: "© 2025، جميع الحقوق محفوظة،",
          companyName: "دار التقنية الحديثة",
          settingsText: "الإعدادات",
          logoutText: "تسجيل الخروج",
          neighborhoodCommittees: "إدارة لجان الأحياء",
          developmentCommittees: "إدارة لجان التنمية والتطوع",
          projectsOverview: "نظرة عامة على المشاريع",
          moreIn2024: "زيادة بنسبة 4% في 2024",
          projectCompletion: "معدل إكمال المشاريع في حلب",
          foodProjects: "مشاريع الغذاء",
          healthProjects: "مشاريع الصحة",
          clothingProjects: "مشاريع الملابس والمساعدات السكنية",
          viewAllProjects: "عرض جميع المشاريع",
          projects: "المشاريع",
          projectName: "اسم المشروع",
          type: "النوع",
          actions: "الإجراءات",
          status: "الحالة",
          projectOrders: "طلبات المشاريع",
          thisMonth: "هذا الشهر",
          timeline: [
            { title: "أغذية", date: "٢٨ كانون الأول ٢٠٢٥" },
            { title: "صحة", date: "١٦ نيسان ٢٠٢٥" },
            { title: "ملابس ومساعدات سكنية", date: "١٧ نيسان ٢٠٢٥" },
            { title: "سكن وإقامة", date: "٢٠ كانون الأول ٢٠٢٥" },
            { title: "تعليم", date: "٠٥ تشرين الثاني ٢٠٢٥" },
            { title: "دعم نفسي وأسري", date: "١٧ كانون الأول ٢٠٢٥" },
          ],
          chartLabels: {
            construction: ["صالح", "متصدع", "متهالك", "جيد"],
            health: ["مشفى", "مستوصف", "عيادة متنقلة", "عيادة"],
            education: ["جامعة", "مدرسة", "مدارس خاصة", "روضات"],
            service: ["مياه", "كهرباء", "صرف صحي", "لا شيء"],
          },
          notifications: {
            addSuccess: "تم إضافة الصلاحية بنجاح",
            addError: "فشل في إضافة الصلاحية",
            editSuccess: "تم تعديل الصلاحية بنجاح",
            editError: "فشل في تعديل الصلاحية",
            deleteSuccess: "تم حذف الصلاحية بنجاح",
            deleteError: "فشل في حذف الصلاحية",
            fetchError: "فشل في جلب الصلاحيات",
            validationError: "خطأ في البيانات المدخلة",
            networkError: "خطأ في الاتصال بالخادم",
            loadSuccess: "تم تحميل السماحيات بنجاح (وضع التجربة)",
          },
        },
        en: {
          neighborhoodCommittees: "Neighborhood Comm",
          developmentCommittees: "Development Comm",
          dir: "ltr",
          dashboard: "Dashboard",
          configTables: "Configuration Tables",
          maps: "Maps",
          manageUsers: "Manage Users",
          langToggleText: "Change Language",
          signIn: "Sign In",
          signUp: "Sign Up",
          permissionsList: "Permissions List",
          addPermission: "Add Permission",
          editPermission: "Edit Permission",
          permissionName: "Permission Name",
          permissionDescription: "Description",
          enterPermissionName: "Enter permission name",
          enterPermissionDescription: "Enter permission description",
          close: "Close",
          save: "Save",
          saveChanges: "Save Changes",
          actions: "Actions",
          edit: "Edit",
          delete: "Delete",
          confirmDelete: "Are you sure you want to delete this permission?",
          fillAllFields: "Please fill all fields",
          demoModeTitle: "Demo Mode:",
          demoModeText:
            "This page works without a backend server. All data is stored locally in the browser.",
          resetButtonText: "Reset",
          resetConfirmMessage:
            "Are you sure you want to reset all data to default state?",
          resetSuccessMessage: "Data reset successfully",
          families: "Families",
          validBuildings: "Valid Buildings",
          residentialBuildings: "Residential Buildings",
          threatened: "Threatened with Removal",
          constructionStatus: "Construction Status",
          educationStatus: "Education Status",
          healthStatus: "Health Status",
          footerText: "© 2025, All rights reserved,",
          companyName: "Hi-Tech House",
          settingsText: "Settings",
          logoutText: "Logout",
          projectsOverview: "Projects Foods And Health overview",
          moreIn2024: "4% more in 2024",
          projectCompletion: "Project completion rate in Aleppo",
          foodProjects: "Food Projects",
          healthProjects: "Health Projects",
          clothingProjects: "Clothing and housing benefits Projects",
          viewAllProjects: "View all Projects",
          projects: "Projects",
          projectName: "NAME OF PROJECT",
          type: "TYPE",
          actions: "ACTIONS",
          status: "STATUS",
          projectOrders: "Projects Orders overview",
          thisMonth: "this month",
          timeline: [
            { title: "Foods", date: "28 DEC 2025" },
            { title: "Health", date: "16 Apr 2025" },
            { title: "Clothing and housing benefits", date: "17 Apr 2025" },
            { title: "Housing and accommodation", date: "20 DEC 2025" },
            { title: "Education", date: "05 Nov 2025" },
            { title: "Psychological and family support", date: "17 DEC 2025" },
          ],
          chartLabels: {
            construction: ["Valid", "Cracked", "Dilapidated", "Good"],
            health: ["Hospital", "Clinic", "Mobile Clinic", "Polyclinic"],
            education: [
              "University",
              "School",
              "Private Schools",
              "Kindergartens",
            ],
            service: ["Water", "Electricity", "Sanitation", "None"],
          },
          notifications: {
            addSuccess: "Permission added successfully",
            addError: "Failed to add permission",
            editSuccess: "Permission updated successfully",
            editError: "Failed to update permission",
            deleteSuccess: "Permission deleted successfully",
            deleteError: "Failed to delete permission",
            fetchError: "Failed to fetch permissions",
            validationError: "Validation error in input data",
            networkError: "Network connection error",
            loadSuccess: "Permissions loaded successfully (Demo Mode)",
          },
        },
      };

      let currentLang = "ar";

      function switchLanguage(lang) {
        // Store the language preference in localStorage
        try {
          localStorage.setItem("preferredLanguage", lang);
        } catch (error) {
          console.error("Error saving language preference:", error);
        }

        // Update aside (sidebar) position based on language
        const aside = document.getElementById("sidenav-main");

        aside.classList.remove("fixed-end", "fixed-start");

        // Update dropdown button container alignment based on language
        const dropdownContainer = document.getElementById(
          "dropdownButtonContainer"
        );
        const projectsTitleContainer = document.getElementById(
          "projectsTitleContainer"
        );
        const helpButton = document.getElementById("helpButton");

        if (lang === "ar") {
          aside.classList.add("fixed-end");
          // For RTL (Arabic)
          if (dropdownContainer) {
            dropdownContainer.classList.remove("text-end");
            dropdownContainer.classList.add("text-start");
          }
          if (projectsTitleContainer) {
            projectsTitleContainer.classList.remove("text-start");
            projectsTitleContainer.classList.add("text-end");
          }
          // Position help button on the left side for Arabic
          if (helpButton) {
            helpButton.style.left = "20px";
            helpButton.style.right = "auto";
          }
        } else {
          aside.classList.add("fixed-start");
          // For LTR (English)
          if (dropdownContainer) {
            dropdownContainer.classList.remove("text-start");
            dropdownContainer.classList.add("text-end");
          }
          if (projectsTitleContainer) {
            projectsTitleContainer.classList.remove("text-end");
            projectsTitleContainer.classList.add("text-start");
          }

          // Position help button on the right side for English
          if (helpButton) {
            helpButton.style.right = "20px";
            helpButton.style.left = "auto";
          }
        }

        // Update document direction

        currentLang = lang;
        const t = translations[lang];

        // Update document direction
        document.documentElement.lang = lang;
        document.documentElement.dir = t.dir;

        // Update aside (sidebar) text
        const navTexts = document.querySelectorAll(".nav-link .nav-link-text");
        if (navTexts[0]) navTexts[0].textContent = t.dashboard;
        if (navTexts[1]) navTexts[1].textContent = t.configTables;
        if (navTexts[2]) navTexts[2].textContent = t.manageUsers;
        if (navTexts[3]) navTexts[3].textContent = t.neighborhoodCommittees;
        if (navTexts[4]) navTexts[4].textContent = t.developmentCommittees;

        const langToggleText = document.getElementById("langToggleText");
        if (langToggleText) langToggleText.textContent = t.langToggleText;

        // Update header menu items (settings/logout)
        const settingsText = document.getElementById("settingsText");
        if (settingsText) settingsText.textContent = t.settingsText;
        const logoutText = document.getElementById("logoutText");
        if (logoutText) logoutText.textContent = t.logoutText;

        // Update page-specific elements
        const pageTitle = document.getElementById("pageTitle");
        if (pageTitle) pageTitle.textContent = t.permissionsList;

        const addPermissionText = document.getElementById("addPermissionText");
        if (addPermissionText) addPermissionText.textContent = t.addPermission;

        const resetButtonText = document.getElementById("resetButtonText");
        if (resetButtonText) resetButtonText.textContent = t.resetButtonText;

        // Update demo mode notice
        const demoModeTitle = document.getElementById("demoModeTitle");
        if (demoModeTitle) demoModeTitle.textContent = t.demoModeTitle;

        const demoModeText = document.getElementById("demoModeText");
        if (demoModeText) demoModeText.textContent = t.demoModeText;

        // Update main cards
        const cardTitles = document.querySelectorAll(".card-title");
        if (cardTitles[0]) cardTitles[0].textContent = t.families;
        if (cardTitles[1]) cardTitles[1].textContent = t.validBuildings;
        if (cardTitles[2]) cardTitles[2].textContent = t.residentialBuildings;
        if (cardTitles[3]) cardTitles[3].textContent = t.threatened;

        // Update chart card titles
        const chartTitles = document.querySelectorAll(
          "h5.card-title.text-center"
        );
        if (chartTitles[0]) chartTitles[0].textContent = t.constructionStatus;
        if (chartTitles[1]) chartTitles[1].textContent = t.educationStatus;
        if (chartTitles[2]) chartTitles[2].textContent = t.healthStatus;

        // Update chart labels and datasets
        if (window.constructionChart) {
          constructionChart.data.labels = t.chartLabels.construction;
          constructionChart.data.datasets[0].label =
            lang === "ar" ? "عدد المنشآت" : "Number of Buildings";
          constructionChart.update();
        }
        if (window.healthChart) {
          healthChart.data.labels = t.chartLabels.health;
          healthChart.data.datasets[0].label =
            lang === "ar" ? "عدد المراكز الصحية" : "Number of Health Centers";
          healthChart.update();
        }
        if (window.educationChart) {
          educationChart.data.labels = t.chartLabels.education;
          educationChart.data.datasets[0].label =
            lang === "ar"
              ? "عدد المنشآت التعليمية"
              : "Number of Educational Facilities";
          educationChart.update();
        }
        if (window.serviceChart) {
          serviceChart.data.labels = t.chartLabels.service;
          serviceChart.update();
        }

        // Update projects section title
        const projectsTitle = document.getElementById("projectsTitle");
        if (projectsTitle) projectsTitle.textContent = t.projects;

        // Update Projects Orders overview section title
        const projectsOrdersTitle = document.getElementById(
          "projectsOrdersTitle"
        );
        if (projectsOrdersTitle)
          projectsOrdersTitle.textContent = t.projectOrders;

        // Update other elements as before...
        const moreIn2024 = document.querySelector(".text-sm .font-weight-bold");
        if (moreIn2024) moreIn2024.textContent = t.moreIn2024;

        const projectCompletion = document.querySelector(".card-header .mb-0");
        if (projectCompletion)
          projectCompletion.textContent = t.projectCompletion;

        // Update project list items
        const projectItems = document.querySelectorAll(
          ".list-group-item .text-sm.font-weight-bold.text-dark"
        );
        if (projectItems[0]) projectItems[0].textContent = t.foodProjects;
        if (projectItems[1]) projectItems[1].textContent = t.healthProjects;
        if (projectItems[2]) projectItems[2].textContent = t.clothingProjects;

        // Update view all projects button
        const viewAllBtn = document.querySelector(".btn-dark.mb-0");
        if (viewAllBtn) viewAllBtn.textContent = t.viewAllProjects;

        // Update projects table headers
        const tableHeaders = document.querySelectorAll("th.text-uppercase");
        if (tableHeaders[0]) tableHeaders[0].textContent = t.projectName;
        if (tableHeaders[1]) tableHeaders[1].textContent = t.type;
        if (tableHeaders[2]) tableHeaders[2].textContent = t.actions;
        if (tableHeaders[3]) tableHeaders[3].textContent = t.status;

        // Update project orders section
        const thisMonthText = document.querySelectorAll(
          ".text-sm .font-weight-bold"
        )[1];
        if (thisMonthText) thisMonthText.textContent = t.thisMonth;

        // Update timeline
        const timelineBlocks = document.querySelectorAll(
          ".timeline-block .timeline-content h6"
        );
        const timelineDates = document.querySelectorAll(
          ".timeline-block .timeline-content p"
        );
        t.timeline.forEach((item, idx) => {
          if (timelineBlocks[idx]) timelineBlocks[idx].textContent = item.title;
          if (timelineDates[idx]) timelineDates[idx].textContent = item.date;
        });

        // Update projects overview and section titles
        const projectsOverviewTitle = document.getElementById(
          "projectsOverviewTitle"
        );
        if (projectsOverviewTitle)
          projectsOverviewTitle.textContent = t.projectsOverview;
      }

      function toggleLanguage() {
        if (currentLang === "ar") {
          switchLanguage("en");
        } else {
          switchLanguage("ar");
        }
      }

      // Add menu functionality
      function toggleMenu() {
        const menu = document.getElementById("menuDropdown");
        menu.style.display = menu.style.display === "block" ? "none" : "block";
      }

      // Close menu when clicking outside
      document.addEventListener("click", function (e) {
        const menu = document.getElementById("menuDropdown");
        const menuBtn = document.getElementById("menuToggleBtn");

        if (menu && menuBtn) {
          if (!menuBtn.contains(e.target) && !menu.contains(e.target)) {
            menu.style.display = "none";
          }
        }
      });

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize scrollbar for Windows platform
        var win = navigator.platform.indexOf("Win") > -1;
        if (win && document.querySelector("#sidenav-scrollbar")) {
          var options = {
            damping: "0.5",
          };
          Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
        }
        // Set initial classes for RTL layout
        const dropdownContainer = document.getElementById(
          "dropdownButtonContainer"
        );
        const projectsTitleContainer = document.getElementById(
          "projectsTitleContainer"
        );
        const helpButton = document.getElementById("helpButton");

        if (dropdownContainer && projectsTitleContainer) {
          // Initial setup for Arabic (RTL)
          dropdownContainer.classList.add("text-start");
          projectsTitleContainer.classList.add("text-end");
        }

        // Initial position for help button (Arabic - RTL)
        if (helpButton) {
          helpButton.style.left = "20px";
          helpButton.style.right = "auto";
        }

        // Check if there's a saved language preference in localStorage
        let savedLanguage;
        try {
          savedLanguage = localStorage.getItem("preferredLanguage");
        } catch (error) {
          console.error("Error retrieving language preference:", error);
          savedLanguage = null;
        }

        // Set initial language based on saved preference or default to Arabic
        const initialLang = savedLanguage || "ar";
        switchLanguage(initialLang);

        // Set language toggle button text based on current language
        const langToggleBtn = document.getElementById("langToggleBtn");
        if (langToggleBtn) {
          // Update the span text inside the button, not the button itself
          const langToggleText = document.getElementById("langToggleText");
          if (langToggleText) {
            langToggleText.textContent =
              initialLang === "ar" ? "تغيير اللغة" : "Change Language";
          }
          // Remove any existing click handlers to avoid duplicates
          langToggleBtn.onclick = function () {
            toggleLanguage();
          };
        }

        // Initialize mock data and load permissions
        initializeMockData();
        fetchPermissions();

        // تعيين onclick الافتراضي لزر الحفظ
        document.getElementById("savePermissionBtn").onclick = addPermission;

        // Close menu when clicking outside
        document.addEventListener("click", function (e) {
          const menu = document.getElementById("menuDropdown");
          const menuBtn = document.getElementById("menuToggleBtn");
          if (
            menu &&
            menuBtn &&
            !menuBtn.contains(e.target) &&
            !menu.contains(e.target)
          ) {
            menu.style.display = "none";
          }
        });
      });

      // Global variables
      let permissions = [];
      let pages = [];

      // Mock data for permissions
      const mockPermissions = [
        {
          id: 1,
          permission_name: "إدارة المستخدمين",
          permission_code: "manage_users",
          description: "صلاحية لإدارة المستخدمين في النظام",
        },
        {
          id: 2,
          permission_name: "إدارة الأدوار",
          permission_code: "manage_roles",
          description: "صلاحية لإدارة الأدوار والصلاحيات",
        },
        {
          id: 3,
          permission_name: "عرض البيانات",
          permission_code: "view_data",
          description: "صلاحية لعرض البيانات والتقارير",
        },
        {
          id: 4,
          permission_name: "تحرير البيانات",
          permission_code: "edit_data",
          description: "صلاحية لتحرير وتعديل البيانات",
        },
      ];

      // Mock data for pages
      const mockPages = [
        { id: 1, page_name_ar: "لوحة التحكم", page_name_en: "Dashboard" },
        {
          id: 2,
          page_name_ar: "إدارة المستخدمين",
          page_name_en: "Manage Users",
        },
        { id: 3, page_name_ar: "إدارة الأدوار", page_name_en: "Manage Roles" },
        {
          id: 4,
          page_name_ar: "إدارة السماحيات",
          page_name_en: "Manage Permissions",
        },
        { id: 5, page_name_ar: "الخرائط", page_name_en: "Maps" },
        { id: 6, page_name_ar: "التقارير", page_name_en: "Reports" },
      ];

      // Local storage keys
      const STORAGE_KEYS = {
        PERMISSIONS: "mock_permissions",
        PAGES: "mock_pages",
      };

      // Initialize mock data in localStorage if not exists
      function initializeMockData() {
        if (!localStorage.getItem(STORAGE_KEYS.PERMISSIONS)) {
          localStorage.setItem(
            STORAGE_KEYS.PERMISSIONS,
            JSON.stringify(mockPermissions)
          );
        }
        if (!localStorage.getItem(STORAGE_KEYS.PAGES)) {
          localStorage.setItem(STORAGE_KEYS.PAGES, JSON.stringify(mockPages));
        }
      }

      // Load permissions from localStorage
      function loadPermissions() {
        permissions = JSON.parse(
          localStorage.getItem(STORAGE_KEYS.PERMISSIONS) || "[]"
        );
      }

      // Save permissions to localStorage
      function savePermissions() {
        localStorage.setItem(
          STORAGE_KEYS.PERMISSIONS,
          JSON.stringify(permissions)
        );
      }

      // Fetch permissions and display
      function fetchPermissions() {
        loadPermissions();
        displayPermissions();
      }

      // Notification helpers
      function showNotification(type, message, title = "") {
        const notificationContainer = document.getElementById("notificationContainer");
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        let icon = "";
        switch (type) {
          case "success": icon = "fas fa-check-circle"; break;
          case "error": icon = "fas fa-exclamation-circle"; break;
          case "warning": icon = "fas fa-exclamation-triangle"; break;
          case "info": icon = "fas fa-info-circle"; break;
          default: icon = "fas fa-info-circle";
        }
        notification.innerHTML = `
          <i class="${icon} notification-icon"></i>
          <div class="notification-content">
            ${title ? `<div class="notification-title">${title}</div>` : ""}
            <div class="notification-message">${message}</div>
          </div>
          <button class="notification-close" onclick="closeNotification(this.parentElement)"><i class="fas fa-times"></i></button>
        `;
        notificationContainer.appendChild(notification);
        setTimeout(() => { if (notification.parentElement) closeNotification(notification); }, 5000);
      }
      function closeNotification(notification) {
        notification.classList.add("slide-out");
        setTimeout(() => { if (notification.parentElement) notification.parentElement.removeChild(notification); }, 300);
      }
      function showInfoNotification(messageKey, title = "", customMessage = "") {
        const message = customMessage || (translations[currentLang].notifications && translations[currentLang].notifications[messageKey]) || messageKey;
        showNotification("info", message, title);
      }
      function showSuccessNotification(messageKey, title = "", customMessage = "") {
        const message = customMessage || (translations[currentLang].notifications && translations[currentLang].notifications[messageKey]) || messageKey;
        showNotification("success", message, title);
      }
      function showErrorNotification(messageKey, title = "", customMessage = "") {
        const message = customMessage || (translations[currentLang].notifications && translations[currentLang].notifications[messageKey]) || messageKey;
        showNotification("error", message, title);
      }
      function showWarningNotification(messageKey, title = "", customMessage = "") {
        const message = customMessage || (translations[currentLang].notifications && translations[currentLang].notifications[messageKey]) || messageKey;
        showNotification("warning", message, title);
      }

      // Add new permission
      function addPermission() {
        const name = document.getElementById("permissionName").value;
        const code = document.getElementById("permissionCode").value;
        // Validate required fields
        if (!name || !code) {
          showErrorNotification(
            "validationError",
            "",
            translations[currentLang].fillAllFields
          );
          return;
        }
        const newPermission = {
          id: Date.now() + Math.floor(Math.random() * 10000),
          permission_name: name,
          permission_code: code,
          description: `صلاحية لـ ${name}`,
        };
        permissions.push(newPermission);
        savePermissions();
        fetchPermissions();
        document.getElementById("addPermissionForm").reset();
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("addPermissionModal")
        );
        modal.hide();
        showSuccessNotification("addSuccess");
      }

      // Delete permission
      function deletePermission(id) {
        if (!confirm(translations[currentLang].confirmDelete)) return;
        permissions = permissions.filter((p) => p.id !== id);
        savePermissions();
        fetchPermissions();
        showSuccessNotification("deleteSuccess");
      }

      // Save edit
      function saveEdit() {
        if (!window.currentEditData) {
          showErrorNotification(
            "validationError",
            "",
            "خطأ: لا توجد بيانات تعديل"
          );
          return;
        }
        const id = window.currentEditData.id;
        const name = document.getElementById("permissionName").value;
        const code = document.getElementById("permissionCode").value;
        if (!name || !code) {
          showErrorNotification(
            "validationError",
            "",
            translations[currentLang].fillAllFields
          );
          return;
        }
        const idx = permissions.findIndex((p) => p.id === id);
        if (idx !== -1) {
          permissions[idx].permission_name = name;
          permissions[idx].permission_code = code;
          permissions[idx].description = `صلاحية لـ ${name}`;
          savePermissions();
          fetchPermissions();
          document.getElementById("addPermissionForm").reset();
          const modal = bootstrap.Modal.getInstance(
            document.getElementById("addPermissionModal")
          );
          modal.hide();
          document.getElementById("savePermissionBtn").onclick = addPermission;
          showSuccessNotification("editSuccess");
        }
      }

      // Display permissions in table
      function displayPermissions() {
        const tbody = document.querySelector("table tbody");
        tbody.innerHTML = "";
        permissions.forEach((permission) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td>
              <h6 class="mb-0 text-sm">${permission.permission_name}</h6>
          </td>
          <td>
              <p class="text-xs font-weight-bold mb-0">${
                permission.description || permission.permission_code
              }</p>
          </td>
          <td class="align-middle text-center">
              <a href="#" class="btn btn-link text-dark px-3 mb-0" onclick="editPermission(${
                permission.id
              })">
                <i class="fas fa-pencil-alt text-dark me-2" aria-hidden="true"></i>${
                  translations[currentLang].edit
                }
              </a>
              <a href="#" class="btn btn-link text-danger text-gradient px-3 mb-0" onclick="deletePermission(${
                permission.id
              })">
                <i class="far fa-trash-alt me-2" aria-hidden="true"></i>${
                  translations[currentLang].delete
                }
            </a>
          </td>
        `;
          tbody.appendChild(tr);
        });
      }

      // Fetch pages from localStorage
      function fetchPages() {
        pages = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAGES) || "[]");
        const pageSelect = document.getElementById("pageSelect");
        pageSelect.innerHTML = '<option value="">اختر الصفحة</option>';
        pages.forEach((pg) => {
          const optionText = `${pg.page_name_ar} / ${pg.page_name_en}`;
          pageSelect.innerHTML += `<option value="${pg.id}">${optionText}</option>`;
        });
      }

      // Reset data to default state
      function resetToDefault() {
        const confirmMessage = translations[currentLang].resetConfirmMessage;
        if (confirm(confirmMessage)) {
          localStorage.setItem(
            STORAGE_KEYS.PERMISSIONS,
            JSON.stringify(mockPermissions)
          );
          localStorage.setItem(STORAGE_KEYS.PAGES, JSON.stringify(mockPages));
          fetchPermissions();
          const successMessage = translations[currentLang].resetSuccessMessage;
          showSuccessNotification("loadSuccess", "", successMessage);
        }
      }

      // Modal event listeners
      const addPermissionModal = document.getElementById("addPermissionModal");
      addPermissionModal.addEventListener("show.bs.modal", function () {
        fetchPages();
        if (window.currentEditData) {
          const permission = window.currentEditData.permission;
          document.getElementById("permissionName").value =
            permission.permission_name;
          document.getElementById("permissionCode").value =
            permission.permission_code;
          document.getElementById("pageSelect").value = permission.page || "";
        }
      });
      const addPermissionModalEl =
        document.getElementById("addPermissionModal");
      addPermissionModalEl.addEventListener("hidden.bs.modal", function () {
        document.getElementById("savePermissionBtn").onclick = addPermission;
        document.getElementById("addPermissionForm").reset();
        delete window.currentEditData;
      });
      window.editPermission = function (id) {
        const permission = permissions.find((p) => p.id === id);
        if (!permission) return;
        window.currentEditData = {
          id: id,
          permission: permission,
        };
        document.getElementById("savePermissionBtn").onclick = saveEdit;
        const modal = new bootstrap.Modal(
          document.getElementById("addPermissionModal")
        );
        modal.show();
      };
    </script>
  </body>
</html>
