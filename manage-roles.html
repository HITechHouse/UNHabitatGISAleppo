<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="shortcut icon"
      href="assets/img/UN_Habitat_Icon.svg"
      type="image/x-icon"
    />
    <title>Manage Permissions</title>
    <!-- Fonts and icons -->
    <link href="libraries/css/inter.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <link href="libraries/css/fontawesome-6.5.1.min.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link
      id="pagestyle"
      href="assets/css/soft-ui-dashboard.css?v=1.1.0"
      rel="stylesheet"
    />

    <!-- Simplified Arabic Font -->
    <link href="libraries/css/noto-naskh-arabic.css" rel="stylesheet" />
    <!-- Github buttons -->


    <script src="libraries/js/buttons.js" async defer></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="libraries/js/soft-ui-dashboard-1.1.0.min.js"></script>

    <!-- Common styles -->
    <link href="assets/css/styles.css" rel="stylesheet" />

    <style>
      /* Page-specific styles for manage-roles.html */

      .menu-item i {
        margin-left: 8px;
        width: 20px;
        text-align: center;
      }

      .menu-item:hover {
        background-color: #f5f5f5;
      }

      body[dir="ltr"] .menu-dropdown-content {
        right: auto;
        left: 0;
      }

      body[dir="ltr"] .menu-item i {
        margin-left: 0;
        margin-right: 8px;
      }

      /* Enhanced Table Header Styles */
      .card-header h6 {
        font-size: 1.5rem !important;
        font-weight: 700 !important;
        color: #344767 !important;
        margin-bottom: 0.5rem !important;
      }

      .table thead th {
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        color: #344767 !important;
        padding: 1rem 0.75rem !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
        border-bottom: 2px solid #e9ecef !important;
        background-color: #f8f9fa !important;
      }

      .table thead th.text-uppercase {
        font-size: 1.1rem !important;
        font-weight: 600 !important;
      }

      /* Font Awesome icon styles */
      .fa,
      .fab,
      .fas,
      .far,
      i.fa,
      i.fab,
      i.fas,
      i.far,
      i.fa-facebook-f,
      i.fa-x-twitter,
      i.fa-instagram,
      i.fa-linkedin-in,
      i.fa-whatsapp {
        font-family: "Font Awesome 6 Free", "Font Awesome 6 Brands" !important;
        display: inline-block !important;
        visibility: visible !important;
      }

      /* Notification styles */
      #notificationContainer {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 350px;
      }

      .notification {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        animation: slideIn 0.3s ease-out;
        position: relative;
        overflow: hidden;
      }

      .notification.success {
        background-color: #d4edda;
        border-left: 4px solid #28a745;
        color: #155724;
      }

      .notification.error {
        background-color: #f8d7da;
        border-left: 4px solid #dc3545;
        color: #721c24;
      }

      .notification.info {
        background-color: #d1ecf1;
        border-left: 4px solid #17a2b8;
        color: #0c5460;
      }

      .notification.warning {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        color: #856404;
      }

      .notification-icon {
        font-size: 20px;
        margin-left: 12px;
        margin-right: 0;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: bold;
        margin-bottom: 4px;
      }

      .notification-message {
        font-size: 14px;
        margin: 0;
      }

      .notification-close {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        padding: 0;
        margin-right: 5px;
        margin-left: 0;
        opacity: 0.7;
      }

      .notification-close:hover {
        opacity: 1;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .notification.slide-out {
        animation: slideOut 0.3s ease-in forwards;
      }

      /* RTL/LTR specific styles */
      body[dir="ltr"] #notificationContainer {
        right: auto;
        left: 20px;
      }

      body[dir="ltr"] .notification-icon {
        margin-left: 0;
        margin-right: 12px;
      }

      body[dir="ltr"] .notification-close {
        margin-right: 0;
        margin-left: 5px;
      }

      body[dir="ltr"] .notification {
        animation: slideInLTR 0.3s ease-out;
      }

      body[dir="ltr"] .notification.slide-out {
        animation: slideOutLTR 0.3s ease-in forwards;
      }

      @keyframes slideInLTR {
        from {
          transform: translateX(-100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutLTR {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(-100%);
          opacity: 0;
        }
      }
    </style>
  </head>

  <body class="g-sidenav-show bg-gray-100">
    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Header -->
    <header id="mainHeader">
      <div style="display: flex; align-items: center; gap: 10px">
        <img
          src="assets/img/aleppo.jfif"
          alt="Logo 1"
          class="header-logo"
          onclick="window.location.href = './welcome.html';"
          style="cursor: pointer"
          title="Aleppo Governorate"
        />
      </div>

      <div class="header-title text-center">
        <div class="title-ar">نظام إدارة المعلومات الحضرية _ مدينة حلب</div>
        <div class="title-en">
          Urban Information Management System - Aleppo City
        </div>
      </div>

      <div class="header-logos right-logos">
        <div class="menu-dropdown">
          <button
            class="menu-toggle"
            id="menuToggleBtn"
            onclick="toggleMenu()"
          ></button>
          <div class="menu-dropdown-content" id="menuDropdown">
            <a
              href="#"
              class="menu-item"
              id="langToggleBtn"
              onclick="toggleLanguage();"
            >
              <i class="fas fa-language"></i>
              <span id="langToggleText">تغيير اللغة</span>
            </a>
            <a
              href="#"
              class="menu-item"
              id="settingsBtn"
              onclick="window.location.href = './profile.html';"
            >
              <i class="fas fa-cog"></i>
              <span id="settingsText">الإعدادات</span>
            </a>
            <a
              href="#"
              class="menu-item"
              id="logoutBtn"
              onclick="logoutUser();"
            >
              <i class="fas fa-sign-out-alt"></i>
              <span id="logoutText">تسجيل الخروج</span>
            </a>
          </div>
        </div>
          <img
            src="assets/img/unhabitat.png"
            alt="Logo 3"
            class="header-logo"
            title="UN Habitat"
            style="background-color: #fff;"
          />
        <img src="assets/img/japan.jpg" alt="Logo 2" class="header-logo" title="From the People of Japanese "/>
      </div>
    </header>

    <aside
      class="sidenav navbar navbar-vertical navbar-expand-xs border-0 my-3 fixed-end bg-gray-300"
      id="sidenav-main"
      style="max-height: calc(100vh - 66px); overflow-y: visible"
    >
      <div class="sidenav-header">
        <i
          class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
          aria-hidden="true"
          id="iconSidenav"
        ></i>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-tachometer-alt"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">Dashboard</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="tables.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-table"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">configuration Tables </span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link active" href="ManageUsers.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
                style="
                  background: linear-gradient(
                    135deg,
                    #007bff 0%,
                    #0056b3 100%
                  ) !important;
                "
              >
                <i
                  class="fas fa-users-cog"
                  style="color: white; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">Manage users</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="neighborhoodCommitteesManagement.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-users"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">إدارة لجان الأحياء</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="developmentCommitteesManagement.html">
              <div
                class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 ms-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-chart-line"
                  style="color: black; font-size: 20px"
                ></i>
              </div>
              <span class="nav-link-text ms-1">إدارة لجان التنمية</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="sidenav-footer mx-3"></div>
    </aside>
    <main
      class="main-content position-relative max-height-vh-100 h-100 border-radius-lg"
    >

      
      <!-- Table Section -->
      <div class="container-fluid py-4">
        <div class="row">
          <div class="col-12 mt-5">
            <div class="card mb-4">
              <div class="card-header pb-0">
                <h6>قائمة الأدوار</h6>
                <div class="d-flex gap-2 float-end">
                  <button
                    class="btn btn-primary btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#addPermissionModal"
                    style="background-color: #007bff; border-color: #007bff"
                  >
                    <i class="fas fa-plus"></i> إضافة دور
                  </button>
                  <button
                    class="btn btn-warning btn-sm"
                    onclick="resetToDefault()"
                    style="
                      background: linear-gradient(
                        135deg,
                        #ffc107 0%,
                        #fd7e14 100%
                      );
                      border: none;
                      box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
                    "
                    title="إعادة تعيين البيانات إلى الحالة الافتراضية"
                  >
                    <i class="fas fa-undo"></i>
                    <span id="resetButtonText">إعادة تعيين</span>
                  </button>
                </div>
              </div>
              <div class="card-body px-0 pt-0 pb-2">
                <div class="table-responsive p-0">
                  <table class="table align-items-center mb-0">
                    <thead>
                      <tr>
                        <th
                          class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"
                        >
                          اسم الدور
                        </th>
                        <th
                          class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"
                        >
                          الوصف
                        </th>
                        <th
                          class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"
                        >
                          الإجراءات
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <h6 class="mb-0 text-sm">إضافة مستخدم</h6>
                        </td>
                        <td>
                          <p class="text-xs font-weight-bold mb-0">
                            دور لإضافة مستخدم جديد.
                          </p>
                        </td>
                        <td class="align-middle text-center">
                          <a
                            href="#"
                            class="btn btn-link text-dark px-3 mb-0"
                            data-bs-toggle="modal"
                            data-bs-target="#editPermissionModal"
                          >
                            <i
                              class="fas fa-pencil-alt text-dark me-2"
                              aria-hidden="true"
                            ></i
                            >تعديل
                          </a>
                          <a
                            href="#"
                            class="btn btn-link text-danger text-gradient px-3 mb-0"
                          >
                            <i
                              class="far fa-trash-alt me-2"
                              aria-hidden="true"
                            ></i
                            >حذف
                          </a>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <h6 class="mb-0 text-sm">تعديل مستخدم</h6>
                        </td>
                        <td>
                          <p class="text-xs font-weight-bold mb-0">
                            دور لتعديل بيانات المستخدمين.
                          </p>
                        </td>
                        <td class="align-middle text-center">
                          <a
                            href="#"
                            class="btn btn-link text-dark px-3 mb-0"
                            data-bs-toggle="modal"
                            data-bs-target="#editPermissionModal"
                          >
                            <i
                              class="fas fa-pencil-alt text-dark me-2"
                              aria-hidden="true"
                            ></i
                            >تعديل
                          </a>
                          <a
                            href="#"
                            class="btn btn-link text-danger text-gradient px-3 mb-0"
                          >
                            <i
                              class="far fa-trash-alt me-2"
                              aria-hidden="true"
                            ></i
                            >حذف
                          </a>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Add Permission Modal -->
    <div
      class="modal fade"
      id="addPermissionModal"
      tabindex="-1"
      aria-labelledby="addPermissionModalLabel"
      aria-hidden="true"
      data-bs-backdrop="false"
    >
      <div class="modal-dialog pt-5">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addPermissionModalLabel">
              إضافة دور جديد
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addRoleForm">
              <div class="mb-3">
                <label for="roleName" class="form-label">اسم الدور</label>
                <input
                  type="text"
                  class="form-control"
                  id="roleName"
                  placeholder="أدخل اسم الدور"
                />
              </div>
              <div class="mb-3">
                <label for="roleDescription" class="form-label">الوصف</label>
                <textarea
                  class="form-control"
                  id="roleDescription"
                  rows="3"
                  placeholder="أدخل وصف الدور"
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              إغلاق
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="saveRoleBtn"
              onclick="addRole()"
              style="background-color: #007bff; border-color: #007bff"
            >
              حفظ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Permission Modal -->
    <div
      class="modal fade"
      id="editPermissionModal"
      tabindex="-1"
      aria-labelledby="editPermissionModalLabel"
      aria-hidden="true"
      data-bs-backdrop="false"
    >
      <div class="modal-dialog pt-5">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editPermissionModalLabel">
              تعديل الدور
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="editRoleName" class="form-label">اسم الدور</label>
                <input
                  type="text"
                  class="form-control"
                  id="editRoleName"
                  placeholder="أدخل اسم الدور"
                />
              </div>
              <div class="mb-3">
                <label for="editRoleDescription" class="form-label"
                  >الوصف</label
                >
                <textarea
                  class="form-control"
                  id="editRoleDescription"
                  rows="3"
                  placeholder="أدخل وصف الدور"
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              إغلاق
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="saveEditRoleBtn"
              onclick="saveEdit()"
              style="background-color: #007bff; border-color: #007bff"
            >
              حفظ التغييرات
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="fixed-plugin">
      <a
        id="helpButton"
        class="fixed-plugin-button text-dark position-fixed px-3 py-2"
        style="bottom: 40px; z-index: 6000"
      >
        <i class="fa fa-question-circle py-2"> </i>
      </a>
    </div>
    <!--   Core JS Files   -->
    <script src="libraries/js/popper-2.11.8.min.js"></script>
    <script src="libraries/js/bootstrap-5.3.2.min.js"></script>
    <script src="libraries/js/perfect-scrollbar-1.5.5.min.js"></script>
    <script src="libraries/js/smooth-scrollbar-8.8.1.min.js"></script>
    <script src="libraries/js/chart-4.4.1.umd.min.js"></script>
    <script>
      // Global variables
      let roles = [];

      // Mock data for roles - 4 default roles only
      const mockRoles = [
        {
          id: 1,
          role_name: "مدير النظام",
          description: "صلاحيات كاملة على النظام - إدارة جميع المستخدمين والأدوار والبيانات"
        },
        {
          id: 2,
          role_name: "مشرف",
          description: "إدارة المستخدمين والمحتوى - صلاحيات إدارية محدودة"
        },
        {
          id: 3,
          role_name: "محرر",
          description: "تحرير المحتوى والبيانات - إضافة وتعديل البيانات"
        },
        {
          id: 4,
          role_name: "مشاهد",
          description: "عرض البيانات فقط - صلاحيات قراءة محدودة"
        }
      ];

      // Local storage keys
      const STORAGE_KEYS = {
        ROLES: 'mock_roles'
      };

      // Initialize mock data in localStorage if not exists
      function initializeMockData() {
        if (!localStorage.getItem(STORAGE_KEYS.ROLES)) {
          localStorage.setItem(STORAGE_KEYS.ROLES, JSON.stringify(mockRoles));
        }
      }

      // Local data management functions (no API needed)
      function getRoles() {
        const rolesData = JSON.parse(localStorage.getItem(STORAGE_KEYS.ROLES) || '[]');
        return rolesData;
      }

      function addRoleToStorage(roleData) {
        const rolesData = getRoles();
        const newRole = {
          id: Date.now() + Math.random(),
          role_name: roleData.role_name,
          description: roleData.description
        };
        rolesData.push(newRole);
        localStorage.setItem(STORAGE_KEYS.ROLES, JSON.stringify(rolesData));
        return newRole;
      }

      function updateRoleInStorage(id, roleData) {
        const rolesData = getRoles();
        const roleIndex = rolesData.findIndex(role => role.id === id);
        if (roleIndex !== -1) {
          rolesData[roleIndex] = {
            ...rolesData[roleIndex],
            role_name: roleData.role_name,
            description: roleData.description
          };
          localStorage.setItem(STORAGE_KEYS.ROLES, JSON.stringify(rolesData));
          return rolesData[roleIndex];
        }
        return null;
      }

      function deleteRoleFromStorage(id) {
        const rolesData = getRoles();
        const filteredData = rolesData.filter(role => role.id !== id);
        localStorage.setItem(STORAGE_KEYS.ROLES, JSON.stringify(filteredData));
        return true;
      }

      // Mock API Helper function (for compatibility)
      async function apiCall(endpoint, options = {}) {
        // Simulate network delay (shorter for demo mode)
        await new Promise(resolve => setTimeout(resolve, 100));

        try {
          // Handle GET requests for roles
          if (endpoint === "/api/roles/") {
            const rolesData = getRoles();
            return { results: rolesData };
          }

          // Handle POST requests for roles
          if (endpoint === "/api/roles/" && options.method === "POST") {
            const body = JSON.parse(options.body);
            const newRole = addRoleToStorage(body);
            return { success: true, data: newRole };
          }

          // Handle PUT requests for roles
          if (endpoint.includes("/api/roles/") && options.method === "PUT") {
            const id = parseInt(endpoint.split("/").pop());
            const body = JSON.parse(options.body);
            const updatedRole = updateRoleInStorage(id, body);
            if (updatedRole) {
              return { success: true, data: updatedRole };
            } else {
              return { success: false, error: "Role not found" };
            }
          }

          // Handle DELETE requests for roles
          if (endpoint.includes("/api/roles/") && options.method === "DELETE") {
            const id = parseInt(endpoint.split("/").pop());
            const success = deleteRoleFromStorage(id);
            return { success: success };
          }

          return { success: true };
        } catch (error) {
          console.error("Local data operation failed:", error);
          throw error;
        }
      }

      // Wait for DOM to be fully loaded
      document.addEventListener("DOMContentLoaded", function () {
        // Function to handle zoom level changes
        function handleZoom() {
          const sidenav = document.getElementById("sidenav-main");
          const windowWidth = window.innerWidth;
          const zoomLevel = window.devicePixelRatio;

          if (zoomLevel > 1.51 || windowWidth < 1200) {
            sidenav.style.display = "none";
          } else {
            sidenav.style.display = "block";
          }
        }

        // Initial check
        handleZoom();

        // Listen for zoom changes
        window.addEventListener("resize", handleZoom);

        // Initialize charts only if the canvas elements exist
        try {
          // Line chart
          if (document.getElementById("chart-line")) {
            var ctx2 = document.getElementById("chart-line").getContext("2d");

            var gradientStroke1 = ctx2.createLinearGradient(0, 230, 0, 50);
            gradientStroke1.addColorStop(1, "rgba(203,12,159,0.2)");
            gradientStroke1.addColorStop(0.2, "rgba(72,72,176,0.0)");
            gradientStroke1.addColorStop(0, "rgba(203,12,159,0)"); //purple colors

            var gradientStroke2 = ctx2.createLinearGradient(0, 230, 0, 50);
            gradientStroke2.addColorStop(1, "rgba(20,23,39,0.2)");
            gradientStroke2.addColorStop(0.2, "rgba(72,72,176,0.0)");
            gradientStroke2.addColorStop(0, "rgba(20,23,39,0)"); //purple colors

            window.lineChart = new Chart(ctx2, {
              type: "line",
              data: {
                labels: [
                  "Apr",
                  "May",
                  "Jun",
                  "Jul",
                  "Aug",
                  "Sep",
                  "Oct",
                  "Nov",
                  "Dec",
                ],
                datasets: [
                  {
                    label: "Foods",
                    tension: 0.4,
                    borderWidth: 3,
                    pointRadius: 0,
                    borderColor: "#cb0c9f",
                    backgroundColor: gradientStroke1,
                    fill: true,
                    data: [50, 40, 300, 220, 500, 250, 400, 230, 500],
                    maxBarThickness: 6,
                  },
                  {
                    label: "Health",
                    tension: 0.4,
                    borderWidth: 3,
                    pointRadius: 0,
                    borderColor: "#3A416F",
                    backgroundColor: gradientStroke2,
                    fill: true,
                    data: [30, 90, 40, 140, 290, 290, 340, 230, 400],
                    maxBarThickness: 6,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false,
                  },
                },
                interaction: {
                  intersect: false,
                  mode: "index",
                },
                scales: {
                  y: {
                    grid: {
                      drawBorder: false,
                      display: true,
                      drawOnChartArea: true,
                      drawTicks: false,
                      borderDash: [5, 5],
                    },
                    ticks: {
                      display: true,
                      padding: 10,
                      color: "#b2b9bf",
                      font: {
                        size: 11,
                        family: "Inter",
                        style: "normal",
                        lineHeight: 2,
                      },
                    },
                  },
                  x: {
                    grid: {
                      drawBorder: false,
                      display: false,
                      drawOnChartArea: false,
                      drawTicks: false,
                      borderDash: [5, 5],
                    },
                    ticks: {
                      display: true,
                      color: "#b2b9bf",
                      padding: 20,
                      font: {
                        size: 11,
                        family: "Inter",
                        style: "normal",
                        lineHeight: 2,
                      },
                    },
                  },
                },
              },
            });
          }

          // Service supply data
          if (document.getElementById("serviceChart")) {
            window.serviceChart = new Chart(
              document.getElementById("serviceChart"),
              {
                type: "pie",
                data: {
                  labels: ["مياه", "كهرباء", "صرف صحي", "لا شيء"],
                  datasets: [
                    {
                      data: [120, 140, 100, 30],
                      backgroundColor: [
                        "#0d6efd",
                        "#198754",
                        "#ffc107",
                        "#dc3545",
                      ],
                    },
                  ],
                },
              }
            );
          }

          // Construction status data
          if (document.getElementById("constructionChart")) {
            window.constructionChart = new Chart(
              document.getElementById("constructionChart"),
              {
                type: "bar",
                data: {
                  labels: ["صالح", "متصدع", "متهالك", "جيد"],
                  datasets: [
                    {
                      label: "عدد المنشآت",
                      data: [85, 20, 10, 40],
                      backgroundColor: "#198754",
                    },
                  ],
                },
                options: {
                  scales: {
                    y: { beginAtZero: true },
                  },
                },
              }
            );
          }

          // Health status data
          if (document.getElementById("healthChart")) {
            window.healthChart = new Chart(
              document.getElementById("healthChart"),
              {
                type: "bar",
                data: {
                  labels: ["مشفى", "مستوصف", "عيادة متنقلة", "عيادة"],
                  datasets: [
                    {
                      label: "عدد المراكز الصحية",
                      data: [85, 30, 15, 55],
                      backgroundColor: "blue",
                    },
                  ],
                },
                options: {
                  scales: {
                    y: { beginAtZero: true },
                  },
                },
              }
            );
          }

          // Educational status data
          if (document.getElementById("educationChart")) {
            window.educationChart = new Chart(
              document.getElementById("educationChart"),
              {
                type: "bar",
                data: {
                  labels: ["جامعة", "مدرسة", "مدارس خاصة", "روضات"],
                  datasets: [
                    {
                      label: " عدد المنشآت التعليمية ",
                      data: [2, 80, 30, 20],
                      backgroundColor: "yellow",
                    },
                  ],
                },
                options: {
                  scales: {
                    y: { beginAtZero: true },
                  },
                },
              }
            );
          }
        } catch (error) {
          console.error("Error initializing charts:", error);
        }

        // Initialize scrollbar
        var win = navigator.platform.indexOf("Win") > -1;
        if (win && document.querySelector("#sidenav-scrollbar")) {
          var options = {
            damping: "0.5",
          };
          Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
        }
      });
    </script>
    <script>
      var win = navigator.platform.indexOf("Win") > -1;
      if (win && document.querySelector("#sidenav-scrollbar")) {
        var options = {
          damping: "0.5",
        };
        Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
      }
    </script>

    <!-- Language Toggle Script -->
    <script>
      const translations = {
        ar: {
          dir: "rtl",
          dashboard: "لوحة التحكم",
          configTables: "جداول الإعدادات",
          maps: "الخرائط",
          manageUsers: "إدارة المستخدمين ",
          langToggleText: "تغيير اللغة",
          signIn: "تسجيل الدخول",
          signUp: "إنشاء حساب",
          permissionsList: "قائمة الأدوار",
          addPermission: "إضافة دور",
          editPermission: "تعديل الدور",
          permissionName: "اسم الدور",
          permissionDescription: "الوصف",
          enterPermissionName: "أدخل اسم الدور",
          enterPermissionDescription: "أدخل وصف الدور",
          close: "إغلاق",
          save: "حفظ",
          saveChanges: "حفظ التغييرات",
          demoModeTitle: "وضع التجربة:",
          demoModeText: "هذه الصفحة تعمل بدون خادم خلفي. جميع البيانات محفوظة محلياً في المتصفح.",
          resetButtonText: "إعادة تعيين",
          resetConfirmMessage: "هل أنت متأكد من إعادة تعيين جميع البيانات إلى الحالة الافتراضية؟",
          resetSuccessMessage: "تم إعادة تعيين البيانات بنجاح",
          actions: "الإجراءات",
          edit: "تعديل",
          delete: "حذف",
          confirmDelete: "هل أنت متأكد من حذف هذا الدور؟",
          fillAllFields: "الرجاء ملء جميع الحقول",
          families: "عدد الأسر",
          validBuildings: "منشآت صالحة",
          residentialBuildings: "منشآت سكنية",
          threatened: "مهددة بالإزالة",
          constructionStatus: "الوضع الإنشائي",
          educationStatus: "الوضع التعليمي",
          healthStatus: "الوضع الصحي",
          footerText: "© 2025، جميع الحقوق محفوظة،",
          companyName: "دار التقنية الحديثة",
          settingsText: "الإعدادات",
          logoutText: "تسجيل الخروج",
          neighborhoodCommittees: "إدارة لجان الأحياء",
          developmentCommittees: "إدارة لجان التنمية والتطوع",
          projectsOverview: "نظرة عامة على المشاريع",
          moreIn2024: "زيادة بنسبة 4% في 2024",
          projectCompletion: "معدل إكمال المشاريع في حلب",
          foodProjects: "مشاريع الغذاء",
          healthProjects: "مشاريع الصحة",
          clothingProjects: "مشاريع الملابس والمساعدات السكنية",
          viewAllProjects: "عرض جميع المشاريع",
          projects: "المشاريع",
          projectName: "اسم المشروع",
          type: "النوع",
          budget: "الميزانية",
          status: "الحالة",
          projectOrders: "طلبات المشاريع",
          thisMonth: "هذا الشهر",
          timeline: [
            { title: "أغذية", date: "٢٨ كانون الأول ٢٠٢٥" },
            { title: "صحة", date: "١٦ نيسان ٢٠٢٥" },
            { title: "ملابس ومساعدات سكنية", date: "١٧ نيسان ٢٠٢٥" },
            { title: "سكن وإقامة", date: "٢٠ كانون الأول ٢٠٢٥" },
            { title: "تعليم", date: "٠٥ تشرين الثاني ٢٠٢٥" },
            { title: "دعم نفسي وأسري", date: "١٧ كانون الأول ٢٠٢٥" },
          ],
          chartLabels: {
            construction: ["صالح", "متصدع", "متهالك", "جيد"],
            health: ["مشفى", "مستوصف", "عيادة متنقلة", "عيادة"],
            education: ["جامعة", "مدرسة", "مدارس خاصة", "روضات"],
            service: ["مياه", "كهرباء", "صرف صحي", "لا شيء"],
          },
          notifications: {
            addSuccess: "تم إضافة الدور بنجاح (محلياً)",
            addError: "فشل في إضافة الدور",
            editSuccess: "تم تعديل الدور بنجاح (محلياً)",
            editError: "فشل في تعديل الدور",
            deleteSuccess: "تم حذف الدور بنجاح (محلياً)",
            deleteError: "فشل في حذف الدور",
            fetchError: "فشل في جلب الأدوار",
            fetchSuccess: "تم تحميل الأدوار بنجاح (وضع التجربة)",
            validationError: "خطأ في البيانات المدخلة",
            networkError: "خطأ في الاتصال بالخادم",
          },
        },
        en: {
          neighborhoodCommittees: "Neighborhood Comm",
          developmentCommittees: "Development Comm",
          dir: "ltr",
          dashboard: "Dashboard",
          configTables: "Configuration Tables",
          maps: "Maps",
          manageUsers: "Manage Users",
          langToggleText: "Change Language",
          signIn: "Sign In",
          signUp: "Sign Up",
          permissionsList: "Roles List",
          addPermission: "Add Role",
          editPermission: "Edit Role",
          permissionName: "Role Name",
          permissionDescription: "Description",
          enterPermissionName: "Enter Role name",
          enterPermissionDescription: "Enter Role description",
          close: "Close",
          save: "Save",
          saveChanges: "Save Changes",
          demoModeTitle: "Demo Mode:",
          demoModeText: "This page works without a backend server. All data is stored locally in the browser.",
          resetButtonText: "Reset",
          resetConfirmMessage: "Are you sure you want to reset all data to default state?",
          resetSuccessMessage: "Data reset successfully",
          actions: "Actions",
          edit: "Edit",
          delete: "Delete",
          confirmDelete: "Are you sure you want to delete this Role?",
          fillAllFields: "Please fill all fields",
          families: "Families",
          validBuildings: "Valid Buildings",
          residentialBuildings: "Residential Buildings",
          threatened: "Threatened with Removal",
          constructionStatus: "Construction Status",
          educationStatus: "Education Status",
          healthStatus: "Health Status",
          footerText: "© 2025, All rights reserved,",
          companyName: "Hi-Tech House",
          settingsText: "Settings",
          logoutText: "Logout",
          projectsOverview: "Projects Foods And Health overview",
          moreIn2024: "4% more in 2024",
          projectCompletion: "Project completion rate in Aleppo",
          foodProjects: "Food Projects",
          healthProjects: "Health Projects",
          clothingProjects: "Clothing and housing benefits Projects",
          viewAllProjects: "View all Projects",
          projects: "Projects",
          projectName: "NAME OF PROJECT",
          type: "TYPE",
          budget: "BUDGET",
          status: "STATUS",
          projectOrders: "Projects Orders overview",
          thisMonth: "this month",
          timeline: [
            { title: "Foods", date: "28 DEC 2025" },
            { title: "Health", date: "16 Apr 2025" },
            { title: "Clothing and housing benefits", date: "17 Apr 2025" },
            { title: "Housing and accommodation", date: "20 DEC 2025" },
            { title: "Education", date: "05 Nov 2025" },
            { title: "Psychological and family support", date: "17 DEC 2025" },
          ],
          chartLabels: {
            construction: ["Valid", "Cracked", "Dilapidated", "Good"],
            health: ["Hospital", "Clinic", "Mobile Clinic", "Polyclinic"],
            education: [
              "University",
              "School",
              "Private Schools",
              "Kindergartens",
            ],
            service: ["Water", "Electricity", "Sanitation", "None"],
          },
          notifications: {
            addSuccess: "Role added successfully (locally)",
            addError: "Failed to add role",
            editSuccess: "Role updated successfully (locally)",
            editError: "Failed to update role",
            deleteSuccess: "Role deleted successfully (locally)",
            deleteError: "Failed to delete role",
            fetchError: "Failed to fetch roles",
            fetchSuccess: "Roles loaded successfully (Demo Mode)",
            validationError: "Validation error in input data",
            networkError: "Network connection error",
          },
        },
      };

      let currentLang = "ar";

      function switchLanguage(lang) {
        // Store the language preference in localStorage
        try {
          localStorage.setItem("preferredLanguage", lang);
        } catch (error) {
          console.error("Error saving language preference:", error);
        }

        // Update aside (sidebar) position based on language
        const aside = document.getElementById("sidenav-main");

        aside.classList.remove("fixed-end", "fixed-start");

        // Update dropdown button container alignment based on language
        const dropdownContainer = document.getElementById(
          "dropdownButtonContainer"
        );
        const projectsTitleContainer = document.getElementById(
          "projectsTitleContainer"
        );
        const helpButton = document.getElementById("helpButton");

        if (lang === "ar") {
          aside.classList.add("fixed-end");
          // For RTL (Arabic)
          if (dropdownContainer) {
            dropdownContainer.classList.remove("text-end");
            dropdownContainer.classList.add("text-start");
          }
          if (projectsTitleContainer) {
            projectsTitleContainer.classList.remove("text-start");
            projectsTitleContainer.classList.add("text-end");
          }
          // Position help button on the left side for Arabic
          if (helpButton) {
            helpButton.style.left = "20px";
            helpButton.style.right = "auto";
          }
        } else {
          aside.classList.add("fixed-start");
          // For LTR (English)
          if (dropdownContainer) {
            dropdownContainer.classList.remove("text-start");
            dropdownContainer.classList.add("text-end");
          }
          if (projectsTitleContainer) {
            projectsTitleContainer.classList.remove("text-end");
            projectsTitleContainer.classList.add("text-start");
          }

          // Position help button on the right side for English
          if (helpButton) {
            helpButton.style.right = "20px";
            helpButton.style.left = "auto";
          }
        }

        // Update document direction

        currentLang = lang;
        const t = translations[lang];

        // Update document direction
        document.documentElement.lang = lang;
        document.documentElement.dir = t.dir;

        // Update aside (sidebar) text
        const navTexts = document.querySelectorAll(".nav-link .nav-link-text");
        if (navTexts[0]) navTexts[0].textContent = t.dashboard;
        if (navTexts[1]) navTexts[1].textContent = t.configTables;
        if (navTexts[2]) navTexts[2].textContent = t.manageUsers;
        if (navTexts[3]) navTexts[3].textContent = t.neighborhoodCommittees;
        if (navTexts[4]) navTexts[4].textContent = t.developmentCommittees;

        const langToggleText = document.getElementById("langToggleText");
        if (langToggleText) langToggleText.textContent = t.langToggleText;

        // Update header menu items (settings/logout)
        const settingsText = document.getElementById("settingsText");
        if (settingsText) settingsText.textContent = t.settingsText;
        const logoutText = document.getElementById("logoutText");
        if (logoutText) logoutText.textContent = t.logoutText;

        // Update main cards
        const cardTitles = document.querySelectorAll(".card-title");
        if (cardTitles[0]) cardTitles[0].textContent = t.families;
        if (cardTitles[1]) cardTitles[1].textContent = t.validBuildings;
        if (cardTitles[2]) cardTitles[2].textContent = t.residentialBuildings;
        if (cardTitles[3]) cardTitles[3].textContent = t.threatened;

        // Update chart card titles
        const chartTitles = document.querySelectorAll(
          "h5.card-title.text-center"
        );
        if (chartTitles[0]) chartTitles[0].textContent = t.constructionStatus;
        if (chartTitles[1]) chartTitles[1].textContent = t.educationStatus;
        if (chartTitles[2]) chartTitles[2].textContent = t.healthStatus;

        // Update chart labels and datasets
        if (window.constructionChart) {
          constructionChart.data.labels = t.chartLabels.construction;
          constructionChart.data.datasets[0].label =
            lang === "ar" ? "عدد المنشآت" : "Number of Buildings";
          constructionChart.update();
        }
        if (window.healthChart) {
          healthChart.data.labels = t.chartLabels.health;
          healthChart.data.datasets[0].label =
            lang === "ar" ? "عدد المراكز الصحية" : "Number of Health Centers";
          healthChart.update();
        }
        if (window.educationChart) {
          educationChart.data.labels = t.chartLabels.education;
          educationChart.data.datasets[0].label =
            lang === "ar"
              ? "عدد المنشآت التعليمية"
              : "Number of Educational Facilities";
          educationChart.update();
        }
        if (window.serviceChart) {
          serviceChart.data.labels = t.chartLabels.service;
          serviceChart.update();
        }

        // Update projects section title
        const projectsTitle = document.getElementById("projectsTitle");
        if (projectsTitle) projectsTitle.textContent = t.projects;

        // Update Projects Orders overview section title
        const projectsOrdersTitle = document.getElementById(
          "projectsOrdersTitle"
        );
        if (projectsOrdersTitle)
          projectsOrdersTitle.textContent = t.projectOrders;

        // Update demo mode notice
        const demoModeTitle = document.getElementById("demoModeTitle");
        if (demoModeTitle) demoModeTitle.textContent = t.demoModeTitle;
        
        const demoModeText = document.getElementById("demoModeText");
        if (demoModeText) demoModeText.textContent = t.demoModeText;

        // Update reset button text
        const resetButton = document.querySelector('button[onclick="resetToDefault()"] span');
        if (resetButton) resetButton.textContent = t.resetButtonText;

        // Update other elements as before...
        const moreIn2024 = document.querySelector(".text-sm .font-weight-bold");
        if (moreIn2024) moreIn2024.textContent = t.moreIn2024;

        const projectCompletion = document.querySelector(".card-header .mb-0");
        if (projectCompletion)
          projectCompletion.textContent = t.projectCompletion;

        // Update project list items
        const projectItems = document.querySelectorAll(
          ".list-group-item .text-sm.font-weight-bold.text-dark"
        );
        if (projectItems[0]) projectItems[0].textContent = t.foodProjects;
        if (projectItems[1]) projectItems[1].textContent = t.healthProjects;
        if (projectItems[2]) projectItems[2].textContent = t.clothingProjects;

        // Update view all projects button
        const viewAllBtn = document.querySelector(".btn-dark.mb-0");
        if (viewAllBtn) viewAllBtn.textContent = t.viewAllProjects;

        // Update projects table headers
        const tableHeaders = document.querySelectorAll("th.text-uppercase");
        if (tableHeaders[0]) tableHeaders[0].textContent = t.projectName;
        if (tableHeaders[1]) tableHeaders[1].textContent = t.type;
        if (tableHeaders[2]) tableHeaders[2].textContent = t.budget;
        if (tableHeaders[3]) tableHeaders[3].textContent = t.status;

        // Update project orders section
        const thisMonthText = document.querySelectorAll(
          ".text-sm .font-weight-bold"
        )[1];
        if (thisMonthText) thisMonthText.textContent = t.thisMonth;

        // Update timeline
        const timelineBlocks = document.querySelectorAll(
          ".timeline-block .timeline-content h6"
        );
        const timelineDates = document.querySelectorAll(
          ".timeline-block .timeline-content p"
        );
        t.timeline.forEach((item, idx) => {
          if (timelineBlocks[idx]) timelineBlocks[idx].textContent = item.title;
          if (timelineDates[idx]) timelineDates[idx].textContent = item.date;
        });

        // Update projects overview and section titles
        const projectsOverviewTitle = document.getElementById(
          "projectsOverviewTitle"
        );
        if (projectsOverviewTitle)
          projectsOverviewTitle.textContent = t.projectsOverview;
      }

      function toggleLanguage() {
        if (currentLang === "ar") {
          switchLanguage("en");
        } else {
          switchLanguage("ar");
        }
      }

      // Add menu functionality
      function toggleMenu() {
        const menu = document.getElementById("menuDropdown");
        menu.style.display = menu.style.display === "block" ? "none" : "block";
      }

      // Close menu when clicking outside
      document.addEventListener("click", function (e) {
        const menu = document.getElementById("menuDropdown");
        const menuBtn = document.getElementById("menuToggleBtn");

        if (menu && menuBtn) {
          if (!menuBtn.contains(e.target) && !menu.contains(e.target)) {
            menu.style.display = "none";
          }
        }
      });

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize scrollbar for Windows platform
        var win = navigator.platform.indexOf("Win") > -1;
        if (win && document.querySelector("#sidenav-scrollbar")) {
          var options = {
            damping: "0.5",
          };
          Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
        }
        // Set initial classes for RTL layout
        const dropdownContainer = document.getElementById(
          "dropdownButtonContainer"
        );
        const projectsTitleContainer = document.getElementById(
          "projectsTitleContainer"
        );
        const helpButton = document.getElementById("helpButton");

        if (dropdownContainer && projectsTitleContainer) {
          // Initial setup for Arabic (RTL)
          dropdownContainer.classList.add("text-start");
          projectsTitleContainer.classList.add("text-end");
        }

        // Initial position for help button (Arabic - RTL)
        if (helpButton) {
          helpButton.style.left = "20px";
          helpButton.style.right = "auto";
        }

        // Check if there's a saved language preference in localStorage
        let savedLanguage;
        try {
          savedLanguage = localStorage.getItem("preferredLanguage");
        } catch (error) {
          console.error("Error retrieving language preference:", error);
          savedLanguage = null;
        }

        // Set initial language based on saved preference or default to Arabic
        const initialLang = savedLanguage || "ar";
        switchLanguage(initialLang);

        // Set language toggle button text based on current language
        const langToggleBtn = document.getElementById("langToggleBtn");
        if (langToggleBtn) {
          // Update the span text inside the button, not the button itself
          const langToggleText = document.getElementById("langToggleText");
          if (langToggleText) {
            langToggleText.textContent = initialLang === "ar" ? "تغيير اللغة" : "Change Language";
          }
          // Remove any existing click handlers to avoid duplicates
          langToggleBtn.onclick = function () {
            toggleLanguage();
          };
        }

        // Load roles when page loads (without notification)
        loadRolesSilently();

        // Set default onclick for save button
        document.getElementById("saveRoleBtn").onclick = addRole;

        // Close menu when clicking outside
        document.addEventListener("click", function (e) {
          const menu = document.getElementById("menuDropdown");
          const menuBtn = document.getElementById("menuToggleBtn");
          if (
            menu &&
            menuBtn &&
            !menuBtn.contains(e.target) &&
            !menu.contains(e.target)
          ) {
            menu.style.display = "none";
          }
        });
      });

      // حذف مصفوفة الأدوار الثابتة - تم تعريفها أعلاه

      // Notification System
      function showNotification(type, message, title = "") {
        const notificationContainer = document.getElementById(
          "notificationContainer"
        );

        // Create notification element
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;

        // Select appropriate icon based on type
        let icon = "";
        switch (type) {
          case "success":
            icon = "fas fa-check-circle";
            break;
          case "error":
            icon = "fas fa-exclamation-circle";
            break;
          case "warning":
            icon = "fas fa-exclamation-triangle";
            break;
          case "info":
            icon = "fas fa-info-circle";
            break;
          default:
            icon = "fas fa-info-circle";
        }

        notification.innerHTML = `
          <i class="${icon} notification-icon"></i>
          <div class="notification-content">
            ${title ? `<div class="notification-title">${title}</div>` : ""}
            <div class="notification-message">${message}</div>
          </div>
          <button class="notification-close" onclick="closeNotification(this.parentElement)">
            <i class="fas fa-times"></i>
          </button>
        `;

        // Add notification to container
        notificationContainer.appendChild(notification);

        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (notification.parentElement) {
            closeNotification(notification);
          }
        }, 5000);
      }

      function closeNotification(notification) {
        notification.classList.add("slide-out");
        setTimeout(() => {
          if (notification.parentElement) {
            notification.parentElement.removeChild(notification);
          }
        }, 300);
      }

      // Helper functions for specific notification types
      function showSuccessNotification(messageKey, title = "") {
        const message = translations[currentLang].notifications[messageKey];
        showNotification("success", message, title);
      }

      function showErrorNotification(
        messageKey,
        title = "",
        customMessage = ""
      ) {
        const message =
          customMessage || translations[currentLang].notifications[messageKey];
        showNotification("error", message, title);
      }

      function showInfoNotification(messageKey, title = "") {
        const message = translations[currentLang].notifications[messageKey];
        showNotification("info", message, title);
      }

      function showWarningNotification(messageKey, title = "") {
        const message = translations[currentLang].notifications[messageKey];
        showNotification("warning", message, title);
      }

      // Function to load roles silently (without notification)
      function loadRolesSilently() {
        try {
          // Initialize mock data
          initializeMockData();
          
          // Get roles directly from localStorage
          roles = getRoles();
          
          // Ensure roles is an array
          if (!Array.isArray(roles)) {
            roles = [];
          }
          
          displayRoles();
        } catch (error) {
          console.error("Error loading roles:", error);
        }
      }

      // Function to fetch roles from localStorage
      async function fetchRoles() {
        try {
          // Initialize mock data
          initializeMockData();
          
          // Get roles directly from localStorage
          roles = getRoles();
          
          // Ensure roles is an array
          if (!Array.isArray(roles)) {
            roles = [];
          }
          
          displayRoles();
          
          // تم حذف إشعار النجاح من هنا
        } catch (error) {
          console.error("Error fetching roles:", error);
          showErrorNotification("fetchError", "", error.message);
        }
      }

      // Function to display roles in the table
      function displayRoles() {
        const tbody = document.querySelector(".table-responsive table tbody");
        if (!tbody) {
          console.error("Table body not found");
          return;
        }
        
        tbody.innerHTML = "";
        
        if (roles.length === 0) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td colspan="3" class="text-center py-4">
              <i class="fas fa-info-circle text-muted me-2"></i>
              ${currentLang === "ar" ? "لا توجد أدوار لعرضها" : "No roles to display"}
            </td>
          `;
          tbody.appendChild(tr);
        } else {
          roles.forEach((role) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
            <td>
              <h6 class="mb-0 text-sm">${role.role_name || ""}</h6>
            </td>
            <td>
              <p class="text-xs font-weight-bold mb-0">${
                role.description || ""
              }</p>
            </td>
            <td class="align-middle text-center">
              <a href="#" class="btn btn-link text-dark px-3 mb-0" onclick="editRole(${
                role.id
              })">
                <i class="fas fa-pencil-alt text-dark me-2" aria-hidden="true"></i>${
                  translations[currentLang].edit
                }
              </a>
              <a href="#" class="btn btn-link text-danger text-gradient px-3 mb-0" onclick="deleteRole(${
                role.id
              })">
                <i class="far fa-trash-alt me-2" aria-hidden="true"></i>${
                  translations[currentLang].delete
                }
              </a>
            </td>
          `;
            tbody.appendChild(tr);
          });
        }

        // Update table headers
        const headers = document.querySelectorAll("th.text-uppercase");
        if (headers[0])
          headers[0].textContent = translations[currentLang].permissionName;
        if (headers[1])
          headers[1].textContent =
            translations[currentLang].permissionDescription;
        if (headers[2])
          headers[2].textContent = translations[currentLang].actions;

        // Update card title and add button
        const cardTitle = document.querySelector(".card-header h6");
        if (cardTitle)
          cardTitle.textContent = translations[currentLang].permissionsList;

        const addButton = document.querySelector(".card-header .btn-primary");
        if (addButton) {
          addButton.innerHTML = `<i class="fas fa-plus"></i> ${translations[currentLang].addPermission}`;
        }
        
        // Update modal titles and buttons
        updateModals();
      }

      // Function to add new role
      async function addRole() {
        try {
          const name = document.getElementById("roleName").value.trim();
          const description = document.getElementById("roleDescription").value.trim();

          // Validate required fields
          if (!name || !description) {
            showErrorNotification(
              "validationError",
              "",
              translations[currentLang].fillAllFields
            );
            return;
          }

          // Add role directly to localStorage
          const newRole = addRoleToStorage({
            role_name: name,
            description: description
          });

          if (newRole) {
            showSuccessNotification("addSuccess");
            await fetchRoles();
            // Reset form fields
            document.getElementById("roleName").value = "";
            document.getElementById("roleDescription").value = "";
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("addPermissionModal")
            );
            if (modal) {
              modal.hide();
            }
          } else {
            showErrorNotification("addError", "", "فشل في إضافة الدور");
          }
        } catch (error) {
          console.error("Error adding role:", error);
          showErrorNotification("networkError");
        }
      }

      // Function to edit role
      window.editRole = async function (id) {
        // ابحث عن الدور في مصفوفة roles
        const role = roles.find((r) => r.id === id);
        if (!role) return;

        // احفظ بيانات التعديل مؤقتاً
        window.currentEditData = {
          id: id,
          role: role,
        };

        // عيّن القيم في النموذج
        document.getElementById("editRoleName").value = role.role_name;
        document.getElementById("editRoleDescription").value = role.description;

        const modal = new bootstrap.Modal(document.getElementById("editPermissionModal"));
        modal.show();
      };

      // Function to save edit
      async function saveEdit() {
        if (!window.currentEditData) {
          showErrorNotification(
            "validationError",
            "",
            "خطأ: لا توجد بيانات تعديل"
          );
          return;
        }

        try {
          const id = window.currentEditData.id;
          const name = document.getElementById("editRoleName").value.trim();
          const description = document.getElementById(
            "editRoleDescription"
          ).value.trim();

          // Validate required fields
          if (!name || !description) {
            showErrorNotification(
              "validationError",
              "",
              translations[currentLang].fillAllFields
            );
            return;
          }

          // Update role directly in localStorage
          const updatedRole = updateRoleInStorage(id, {
            role_name: name,
            description: description
          });

          if (updatedRole) {
            showSuccessNotification("editSuccess");
            await fetchRoles();
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("editPermissionModal")
            );
            if (modal) {
              modal.hide();
            }
            // Clean temporary edit data
            delete window.currentEditData;
          } else {
            showErrorNotification("editError", "", "الدور غير موجود");
          }
        } catch (error) {
          console.error("Error updating role:", error);
          showErrorNotification("networkError");
        }
      }

      // Function to delete role
      window.deleteRole = async function (id) {
        if (!confirm(translations[currentLang].confirmDelete)) return;

        try {
          // Delete role directly from localStorage
          const success = deleteRoleFromStorage(id);

          if (success) {
            showSuccessNotification("deleteSuccess");
            await fetchRoles();
          } else {
            showErrorNotification("deleteError", "", "فشل في حذف الدور");
          }
        } catch (error) {
          console.error("Error deleting role:", error);
          showErrorNotification("networkError");
        }
      };

      // Reset data to default state
      function resetToDefault() {
        const confirmMessage = translations[currentLang].resetConfirmMessage;
        if (confirm(confirmMessage)) {
          // Clear localStorage
          localStorage.removeItem(STORAGE_KEYS.ROLES);
          
          // Reinitialize mock data
          initializeMockData();
          
          // Reload data
          fetchRoles();
          
          const successMessage = translations[currentLang].resetSuccessMessage;
          showSuccessNotification("addSuccess", "", successMessage);
        }
      }

      // Update modal content when language changes
      function updateModals() {
        // Update Add Permission Modal
        const addModal = document.getElementById("addPermissionModal");
        if (addModal) {
          addModal.querySelector(".modal-title").textContent =
            translations[currentLang].addPermission;
          addModal.querySelector('label[for="roleName"]').textContent =
            translations[currentLang].permissionName;
          addModal.querySelector('label[for="roleDescription"]').textContent =
            translations[currentLang].permissionDescription;
          addModal.querySelector("#roleName").placeholder =
            translations[currentLang].enterPermissionName;
          addModal.querySelector("#roleDescription").placeholder =
            translations[currentLang].enterPermissionDescription;
          addModal.querySelector(".btn-secondary").textContent =
            translations[currentLang].close;
          addModal.querySelector(".btn-primary").textContent =
            translations[currentLang].save;
        }

        // Update Edit Permission Modal
        const editModal = document.getElementById("editPermissionModal");
        if (editModal) {
          editModal.querySelector(".modal-title").textContent =
            translations[currentLang].editPermission;
          editModal.querySelector('label[for="editRoleName"]').textContent =
            translations[currentLang].permissionName;
          editModal.querySelector(
            'label[for="editRoleDescription"]'
          ).textContent = translations[currentLang].permissionDescription;
          editModal.querySelector("#editRoleName").placeholder =
            translations[currentLang].enterPermissionName;
          editModal.querySelector("#editRoleDescription").placeholder =
            translations[currentLang].enterPermissionDescription;
          editModal.querySelector(".btn-secondary").textContent =
            translations[currentLang].close;
          editModal.querySelector(".btn-primary").textContent =
            translations[currentLang].saveChanges;
        }
      }

      // Modify the switchLanguage function to update modals
      const originalSwitchLanguage = switchLanguage;
      switchLanguage = function (lang) {
        originalSwitchLanguage(lang);
        updateModals();
        displayRoles();
      };

      // Add event listeners when document is loaded
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize mock data first
        initializeMockData();
        
        // Then fetch and display roles
        fetchRoles();
        
        // Show demo mode notification after a short delay
        setTimeout(() => {
          const demoMessage = currentLang === "ar" 
            ? "تم تحميل البيانات بنجاح (وضع التجربة)" 
            : "Data loaded successfully (Demo Mode)";
          showInfoNotification("fetchSuccess", "", demoMessage);
        }, 500);
      });
    </script>
  </body>
</html>
